# Feature-Sliced Design (FSD)

## Слои

Слои — первый уровень организации кода в FSD. Разделяют код по уровню ответственности и зависимостей.

**6 слоёв** (от наибольшей ответственности к наименьшей):

```
src/
├── app/        # Инициализация приложения (провайдеры, роутер, стили)
├── pages/      # Страницы/экраны приложения
├── widgets/    # Крупные самодостаточные UI-блоки
├── features/   # Действия пользователя (бизнес-логика)
├── entities/   # Бизнес-сущности (User, Product, Order)
└── shared/     # Переиспользуемый код без бизнес-логики
```

### Правило импорта слоёв

Модуль может импортировать только из слоёв **строго ниже**.

```
app → pages → widgets → features → entities → shared
```

**Исключения:** `app` и `shared` — слои без слайсов, сегменты внутри них могут импортировать друг друга.

---

## Слайсы

Слайсы — **второй уровень** организации. Группируют код по бизнес-значению.

```
features/
├── auth/           # Слайс авторизации
├── comments/       # Слайс комментариев
└── search/         # Слайс поиска
```

### Принципы слайсов

| Принцип                  | Описание                                                  |
| ------------------------ | --------------------------------------------------------- |
| **Нулевая сцепленность** | Слайсы независимы друг от друга на одном слое             |
| **Высокая связность**    | Весь код, связанный с одной задачей, внутри одного слайса |

### Правило публичного API

Каждый слайс должен иметь **публичный API** (обычно `index.ts`):

```
features/auth/
├── ui/
├── model/
├── api/
└── index.ts        # Публичный API — только через него импортируют извне
```

```typescript
// ✅ Правильно
import { LoginForm } from "features/auth";

// ❌ Неправильно — обращение к внутренней структуре
import { LoginForm } from "features/auth/ui/login-form";
```

### Группировка слайсов

Связанные слайсы можно группировать в папку, но **без общего кода**:

```
features/
└── post/
    ├── compose/    # Слайс
    ├── like/       # Слайс
    └── delete/     # Слайс
```

### Слои без слайсов

`shared` и `app` не содержат слайсов — сразу сегменты.

---

## Сегменты

Сегменты — **третий уровень** организации. Группируют код по техническому назначению.

### Стандартные сегменты

| Сегмент | Назначение |
|---------|------------|
| `ui` | UI-компоненты, стили, форматтеры |
| `api` | Запросы к бэкенду, типы ответов, мапперы |
| `model` | Схемы, интерфейсы, стор, бизнес-логика |
| `lib` | Вспомогательный код для этого слайса |
| `config` | Конфигурация, фиче-флаги |

### Структура слайса

```
features/auth/
├── ui/
│   ├── login-form.tsx
│   └── logout-button.tsx
├── api/
│   └── auth-api.ts
├── model/
│   ├── auth-store.ts
│   └── types.ts
└── index.ts
```

### Именование сегментов

```
// ❌ Плохо — описывает ЧТО это
components/
hooks/
types/

// ✅ Хорошо — описывает ДЛЯ ЧЕГО
ui/
model/
api/
```

---

## Публичный API

Публичный API — контракт между слайсом и кодом, который его использует. Реализуется как индексный файл с реэкспортами.

### Пример публичного API

```typescript
// pages/auth/index.ts
export { LoginPage } from "./ui/login-page";
export { RegisterPage } from "./ui/register-page";
```

### Цели хорошего публичного API

| Цель | Описание |
|------|----------|
| **Защита от рефакторинга** | Изменение структуры слайса не ломает внешний код |
| **Явные изменения** | Изменения поведения отражаются в публичном API |
| **Минимальный экспорт** | Только необходимые части доступны извне |

### Антипаттерн: слепые реэкспорты

```typescript
// ❌ Плохо — непонятно что экспортируется
export * from "./ui/comment";
export * from "./model/comments";

// ✅ Хорошо — явный контракт
export { Comment } from "./ui/comment";
export { useComments, addComment } from "./model/comments";
export type { CommentData } from "./model/types";
```

### @x-нотация для кросс-импортов

Когда сущность B должна импортировать из сущности A:

```
entities/
├── A/
│   ├── @x/
│   │   └── B.ts      # Публичный API только для B
│   └── index.ts      # Обычный публичный API
└── B/
    └── model/
        └── b.ts      # import from "entities/A/@x/B"
```

```typescript
// entities/A/@x/B.ts
export type { EntityA } from "../model/types";

// entities/B/model/b.ts
import type { EntityA } from "entities/A/@x/B";
```

> Используйте @x-нотацию только на уровне Entities и сводите кросс-импорты к минимуму.

---

## Проблемы с индексными файлами

### Циклические импорты

```typescript
// ❌ Создаёт цикл: index.ts → HomePage.tsx → index.ts
// pages/home/ui/HomePage.tsx
import { loadUserStatistics } from "../";

// ✅ Правильно — полный относительный путь
import { loadUserStatistics } from "../api/load-user-statistics";
```

**Правила:**
- Внутри слайса — относительные импорты с полным путём
- Между слайсами — абсолютные импорты через алиас

### Tree-shaking в shared/ui и shared/lib

Проблема: один индексный файл тянет все зависимости.

```
// ❌ Один index.ts для всего shared/ui
shared/ui/index.ts → тянет carousel с тяжёлой библиотекой

// ✅ Отдельный index.ts для каждого компонента
shared/ui/button/index.ts
shared/ui/carousel/index.ts
```

```typescript
// Импорт напрямую
import { Button } from "@/shared/ui/button";
import { TextField } from "@/shared/ui/text-field";
```

### Оптимизация для больших проектов

1. **Отдельные индексы** для shared/ui и shared/lib
2. **Без индексов в сегментах** — только на уровне слайса
3. **Монорепозиторий** — разделение на пакеты с отдельными FSD-корнями

---

## Описание слоёв

| Слой | Назначение | Сегменты |
|------|-----------|----------|
| **shared** | UI-kit, API-клиент, утилиты, конфиг | `api`, `ui`, `lib`, `config`, `routes`, `i18n` |
| **entities** | Бизнес-сущности | `model`, `api`, `ui` |
| **features** | Действия пользователя | `ui`, `api`, `model`, `config` |
| **widgets** | Крупные переиспользуемые блоки | `ui` |
| **pages** | Страницы приложения | `ui`, `api` |
| **app** | Инициализация, провайдеры | `routes`, `store`, `styles`, `entrypoint` |
