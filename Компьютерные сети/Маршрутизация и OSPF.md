# Маршрутизация и OSPF

## Общие принципы маршрутизации

### Назначение маршрутизатора
Маршрутизатор (роутер) отвечает за доставку данных точно до получателя через множество промежуточных устройств. Когда к нему приходит пакет с запросом, он отправляет его куда нужно.

### Таблица маршрутизации
- Специальная таблица, в которой описано, куда отправлять пакеты
- Каждый роутер знает только то, куда нужно переслать пакет на следующем шаге
- Роутер не знает полный путь до получателя, но благодаря маршрутизации данные доходят куда надо

## Типы маршрутизации

### Статическая маршрутизация
- Администратор настраивает все вручную на каждом устройстве
- Указывает, через какой интерфейс отправлять пакеты в определенную сеть
- **Недостатки:**
  - Нужно прописывать на каждом маршрутизаторе
  - Легко ошибиться при заполнении
  - Сложно поддерживать в актуальном состоянии

### Динамическая маршрутизация
- Включение протокола динамической маршрутизации на каждом роутере
- Таблица маршрутизации заполняется автоматически
- Маршрутизаторы обмениваются информацией о сети
- Поддерживают таблицу маршрутизации в актуальном состоянии
- При изменениях все маршрутизаторы мгновенно узнают об этом

## Протокол OSPF (Open Shortest Path First)

### Определение
OSPF - это протокол динамической маршрутизации, который:
- Отслеживает состояние канала (Link State)
- Использует алгоритм Дейкстры для нахождения кратчайшего пути

### Тип протокола
- **IGP (Interior Gateway Protocol)** - протокол внутридоменной маршрутизации
- Используется для маршрутизации в пределах ограниченной сети (например, сети провайдера)
- **Другие IGP протоколы:** RIP, IGRP, ISIS

### EGP протоколы
- **EGP (Exterior Gateway Protocol)** - протоколы междудоменной маршрутизации
- Используются для маршрутизации между разными сетями
- **Самый известный:** BGP

## Принцип работы OSPF

### 1. Установление соседских отношений
- OSPF-маршрутизаторы должны распознать друг друга
- Отправка специальных "Hello" сообщений на все интерфейсы
- Ожидание ответного приветствия от соседа
- Если ответа нет - сосед признается мертвым

### 2. Обмен LSA (Link State Advertisement)
- Содержат информацию о:
  - Соседском роутере
  - Состоянии каждого напрямую подключенного канала
  - Метрике COST (стоимости)
- Хранение в базе LSDB (Link State Database)
- Все роутеры должны иметь одинаковую информацию в LSDB

### 3. Метрика COST (стоимость)
- Значение, присваиваемое каналу на основании пропускной способности
- **Расчет:** эталонная пропускная способность (100 Мбит/с) / пропускная способность интерфейса
- Показывает "стоимость" прохождения по пути

### 4. Распространение LSA
- Маршрутизаторы рассылают свои LSA соседям
- Соседи пересылают LSA другим соседям
- Процесс продолжается, пока все роутеры не получат все LSA

### 5. Построение топологии
- После получения LSA маршрутизаторы строят таблицу топологии LSDB
- Содержит всю информацию о топологии области

### 6. Алгоритм Дейкстры (SPF)
- **SPF (Shortest Path First)** - выбор наилучшего пути
- Рассчитывает оптимальный маршрут к каждой сети
- Создает дерево SPF
- В таблицу маршрутизации добавляется маршрут с наименьшей стоимостью

## Роли в OSPF

### DR (Designated Router) - Выделенный маршрутизатор
- "Крестный отец" в сети
- Обычные маршрутизаторы подключаются к DR
- DR рассылает информацию об изменениях всем остальным

### BDR (Backup Designated Router) - Запасной выделенный маршрутизатор
- "Консельери" - замена для DR
- Активируется, если DR становится недоступен

### Назначение ролей
- Происходит автоматически
- Администратор может настроить роли вручную

## Преимущества OSPF

1. **Автоматическое обновление** - маршруты всегда актуальны
2. **Быстрая конвергенция** - быстрое восстановление при изменениях
3. **Оптимальные маршруты** - выбор самого быстрого пути
4. **Масштабируемость** - работает в больших сетях
5. **Отказоустойчивость** - продолжает работать при отказе отдельных устройств

## Постоянная работа протокола

- Отправка Hello сообщений соседям
- Мониторинг состояния соседних роутеров
- Обновление таблиц при изменениях
- Уведомление всех роутеров о недоступности соседа
