# EIGRP (Enhanced Interior Gateway Routing Protocol)

## Введение в EIGRP

### Определение
**EIGRP (Enhanced Interior Gateway Routing Protocol)** - это "Расширенный протокол маршрутизации внутреннего шлюза", разработанный компанией Cisco.

**Характеристики:**
- **Проприетарный протокол** - изначально только для устройств Cisco
- **Открытие в 2013 году** - Cisco сделала протокол открытым
- **Практически остался проприетарным** - исходный код не был открыт
- **Низкая адаптация** - другие вендоры не стали его использовать

### Типы маршрутизации

#### Статическая маршрутизация
**Принцип работы:**
- **Ручная настройка** - инженер пишет маршруты вручную
- **Поддержка** - постоянное обновление конфигураций
- **Проблемы** - легко забыть настроить что-то важное
- **Результат** - "получение по жопе" за ошибки

#### Динамическая маршрутизация
**Принцип работы:**
- **Автоматическая настройка** - умные машины настраивают маршруты
- **Автоматическое обновление** - маршруты обновляются сами
- **Проблемы** - при поломках инженер все равно "получает по жопе"
- **Преимущества** - меньше ручной работы

### Классификация протоколов маршрутизации

#### По области применения
**Внутридоменные протоколы (IGP):**
- **OSPF** - Link-State протокол
- **EIGRP** - Distance-Vector протокол
- **RIP** - Distance-Vector протокол

**Междоменные протоколы (EGP):**
- **BGP** - Border Gateway Protocol

#### По типу алгоритма
**Distance-Vector протоколы:**
- **Принцип:** Маршрутизатор знает только своих соседей
- **Примеры:** EIGRP, RIP
- **Аналогия:** Знать только Валерия Палыча из соседней квартиры

**Link-State протоколы:**
- **Принцип:** Маршрутизатор знает топологию всей сети
- **Примеры:** OSPF, IS-IS
- **Аналогия:** Знать весь район, зарплаты жителей и их предпочтения

## Принцип работы EIGRP

### Цель протокола
**Основная задача:** Узнать лучший маршрут до определенной подсети.

**Отличие от OSPF:**
- **EIGRP:** Не хранит всю карту сети
- **OSPF:** Хранит полную карту сети
- **EIGRP:** Знает только о своих соседях

### Три базовых этапа работы

#### 1. Установление соседства
**Процесс:**
- **Отправка Hello** - мультикаст сообщение во все стороны
- **Проверка параметров** - принимающий роутер проверяет:
  - Подсеть
  - Автономную систему
  - Совпадение системы расчета метрик
  - Аутентификацию (если настроена)
  - К-коэффициенты
- **Добавление в список** - если все параметры совпадают

#### 2. Обмен информацией о маршрутах
**Процесс:**
- **Update сообщения** - обмен списками известных маршрутов
- **Взаимный обмен** - инициатор и принимающий обмениваются данными
- **RTP протокол** - Reliable Transport Protocol для пересылки

**Важно:** Не путать RTP (Reliable Transport Protocol) с RTP (Real-time Transport Protocol) для аудио/видео

#### 3. Выбор лучшего маршрута
**Процесс:**
- **Анализ полученной информации** - изучение всех маршрутов
- **Расчет метрик** - определение лучшего пути
- **Добавление в таблицу** - лучший маршрут в таблицу маршрутизации
- **Распространение** - передача информации другим соседям

### Поддержание соседства
**Hello пакеты:**
- **Периодическая отправка** - для обозначения активности
- **Проверка "живости"** - подтверждение работы маршрутизатора
- **Update сообщения** - при изменениях в маршрутах

## Таблицы EIGRP

### Три основные таблицы

#### 1. Таблица соседей (Neighbor Table)
**Содержимое:**
- **Активные соседи** - все текущие "друзья" роутера
- **Статус соединения** - состояние связи с каждым соседом
- **Параметры** - настройки для каждого соседа

#### 2. Таблица топологии (Topology Table)
**Содержимое:**
- **Информация о маршрутах** - от всех соседей
- **Метрики** - характеристики каждого маршрута
- **Альтернативные пути** - возможные варианты доставки

#### 3. Таблица маршрутизации (Routing Table)
**Содержимое:**
- **Лучшие маршруты** - выбранные оптимальные пути
- **Основа для решений** - куда отправлять данные
- **Активные маршруты** - используемые в данный момент

### Процесс обработки данных
**Алгоритм:**
1. **Получение данных** от соседей
2. **Анализ информации** - изучение маршрутов
3. **Расчет лучших маршрутов** - выбор оптимальных путей
4. **Обновление таблицы** - добавление в таблицу маршрутизации

## Обработка сбоев в EIGRP

### Сценарий падения линка
**Что происходит:**
- **Обнаружение сбоя** - сосед перестает отвечать
- **Поиск альтернативы** - попытка найти новый маршрут
- **Активный поиск** - рассылка Query сообщений

### Состояния маршрутов
**Active (Активный):**
- **Недоступные маршруты** - в процессе поиска альтернативы
- **Парадокс** - "активный" означает проблемный
- **Поиск решения** - рассылка запросов соседям

**Passive (Пассивный):**
- **Рабочие маршруты** - все в порядке
- **Стабильное состояние** - маршрут функционирует нормально

### Процесс восстановления
**Query сообщения:**
- **Рассылка всем соседям** - запрос альтернативных маршрутов
- **Ожидание ответов** - получение Reply сообщений
- **Анализ предложений** - изучение полученных маршрутов

**Reply сообщения:**
- **Предложение маршрутов** - альтернативные пути
- **Отказ** - если маршрутов нет
- **Удаление** - если ничего не найдено

## Алгоритм DUAL

### Определение
**DUAL (Diffusive Update Algorithm)** - алгоритм выбора маршрутов в EIGRP.

**Назначение:**
- **Выбор лучшего маршрута** - из всех доступных
- **Быстрое переключение** - при сбоях
- **Предотвращение петель** - избежание циклических маршрутов

### Метрика EIGRP

#### Формула расчета
**Полная формула:**
```
(K1 * bw + (K2 * bw) / (256 — load) + K3 * delay) * (K5 / (reliability + K4))
```

**Компоненты:**
- **bw (bandwidth)** - пропускная способность
- **delay** - задержка
- **load** - загрузка
- **reliability** - надежность
- **K1-K5** - коэффициенты управления

#### Упрощенная формула
**Стандартные значения коэффициентов:**
- **K1 = 1** - коэффициент пропускной способности
- **K2 = 0** - коэффициент загрузки
- **K3 = 1** - коэффициент задержки
- **K4 = 0** - коэффициент надежности
- **K5 = 0** - дополнительный коэффициент

**Упрощенная формула:**
```
bw + delay
```

#### Расчет компонентов
**Bandwidth (bw):**
- **Формула:** 10,000,000 / (минимальная пропускная способность) * 256
- **Принцип:** Чем больше пропускная способность, тем меньше метрика

**Delay:**
- **Формула:** Сумма всех задержек * 256
- **Принцип:** Чем меньше задержка, тем лучше маршрут

### Сравнение с другими протоколами
**RIP:**
- **Метрика:** Количество хопов (маршрутизаторов)
- **Простота:** Очень простая формула
- **Недостатки:** Не учитывает качество каналов

**OSPF:**
- **Метрика:** Пропускная способность
- **Формула:** 100,000,000 / bandwidth
- **Преимущества:** Учитывает качество каналов

**EIGRP:**
- **Метрика:** Комплексная (пропускная способность + задержка)
- **Гибкость:** Настраиваемые коэффициенты
- **Преимущества:** Более точная оценка качества маршрута

## Ключевые понятия EIGRP

### Feasible Distance (FD)
**Определение:** Метрика маршрута с точки зрения текущего роутера до точки назначения.

**Характеристики:**
- **Локальная метрика** - расчет от текущего роутера
- **Включает все промежуточные** - сумма всех участков пути
- **Основа для выбора** - главный критерий оптимизации

### Advertised Distance (AD)
**Определение:** Метрика маршрута с точки зрения соседа, который рассказал о маршруте.

**Характеристики:**
- **Метрика соседа** - как видит путь соседний роутер
- **Не включает текущий участок** - только до соседа
- **Для проверки условий** - используется в алгоритме DUAL

### Аналогия с деревней
**Сценарий:** Поиск самогонщика в деревне

**Дядя Вайт говорит:**
- "Джесси живет через 3 дома от меня"
- **AD = 3** - расстояние от дяди Вайта до Джесси
- **FD = 4** - расстояние от вас до Джесси (3 + 1 до дяди Вайта)

### Successor и Feasible Successor

#### Successor
**Определение:** Маршрут с самой лучшей метрикой.

**Характеристики:**
- **Добавляется в таблицу** - основной маршрут
- **Активно используется** - для передачи данных
- **Лучшая метрика** - минимальное значение FD

#### Feasible Successor
**Определение:** Дублер Successor'а для быстрого переключения.

**Условие отбора:**
- **AD < FD Successor'а** - метрика соседа должна быть меньше
- **Гарантия отсутствия петель** - предотвращение циклических маршрутов
- **Быстрое переключение** - при падении основного маршрута

**Преимущества:**
- **Мгновенное переключение** - без поиска альтернатив
- **Отсутствие петель** - математически гарантировано
- **Высокая надежность** - быстрая реакция на сбои

## Практическое применение

### Настройка метрик
**Цели изменения:**
- **Принудительное направление трафика** - по нужному маршруту
- **Выбор запасных путей** - альтернативные маршруты
- **Балансировка нагрузки** - распределение трафика

**Методы влияния:**
- **Изменение пропускной способности** - на интерфейсах
- **Настройка коэффициентов** - K1-K5
- **Изменение задержек** - на каналах связи

### Преимущества EIGRP
**Технические преимущества:**
- **Быстрая сходимость** - быстрое восстановление после сбоев
- **Эффективное использование полосы** - минимальный служебный трафик
- **Гибкость настройки** - множество параметров
- **Отсутствие петель** - математически гарантировано

**Практические преимущества:**
- **Простота настройки** - относительно легкая конфигурация
- **Стабильность работы** - надежная работа в больших сетях
- **Масштабируемость** - поддержка больших сетей
- **Интеграция с Cisco** - оптимальная работа с оборудованием Cisco

### Недостатки EIGRP
**Ограничения:**
- **Проприетарность** - в основном только Cisco
- **Сложность формулы** - трудности в понимании метрик
- **Зависимость от вендора** - привязка к Cisco
- **Ограниченная поддержка** - не все вендоры поддерживают

## Современное состояние EIGRP

### Открытие протокола
**2013 год:**
- **Cisco открыла протокол** - сделала его публичным
- **Проблема с исходным кодом** - код не был открыт
- **Низкая адаптация** - другие вендоры не заинтересовались

### Альтернативы
**Современные протоколы:**
- **OSPF** - открытый стандарт, широко поддерживается
- **IS-IS** - альтернатива OSPF
- **BGP** - для междоменной маршрутизации

### Области применения
**Где используется EIGRP:**
- **Корпоративные сети** - особенно с оборудованием Cisco
- **Сети провайдеров** - в некоторых случаях
- **Гибридные сети** - в сочетании с другими протоколами

## Заключение

EIGRP представляет собой мощный и гибкий протокол динамической маршрутизации с уникальными особенностями:

**Ключевые особенности:**
1. **Distance-Vector алгоритм** - знает только соседей
2. **Алгоритм DUAL** - быстрая сходимость и отсутствие петель
3. **Комплексная метрика** - учет пропускной способности и задержки
4. **Successor/Feasible Successor** - мгновенное переключение при сбоях

**Практическая ценность:**
- **Быстрое восстановление** после сбоев
- **Гибкая настройка** маршрутизации
- **Эффективное использование** сетевых ресурсов
- **Высокая надежность** работы

**Ограничения:**
- **Проприетарность** - в основном Cisco
- **Сложность понимания** - требует глубоких знаний
- **Ограниченная поддержка** - не все вендоры

EIGRP остается популярным выбором в корпоративных средах, особенно в сетях с преобладанием оборудования Cisco, благодаря своей надежности, гибкости и эффективности.

