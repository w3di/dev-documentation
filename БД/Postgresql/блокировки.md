## Блокировки в СУБД

СУБД обеспечивают возможность множеству пользователей одновременно извлекать и модифицировать данные. Если пользователи в основном осуществляют только чтение данных, нагрузка не представляет особой сложности для сервера. Но если некоторые пользователи одновременно добавляют и/или изменяют данные, то серверу приходится решать более сложные задачи.

## Блокировка

Блокировка — это метод ограничения доступа к данным для обеспечения корректной обработки транзакций.

Серверы баз данных используют блокировки, чтобы управлять одновременным доступом к данным, чтобы пока одна транзакция работает с данными, другие транзакции не могли их изменять.

Когда данные в базе блокируются, другие пользователи, которые хотят изменить или прочитать эти же данные, должны подождать, пока блокировка не будет снята.

## Гранулярность блокировок

Сервер может применять блокировку на одном из трёх разных уровней, или гранулярностей.

Блокировка таблиц:
- Не позволяет нескольким пользователям одновременно изменять данные в одной таблице

Блокировка страниц:
- Не позволяет нескольким пользователям изменять данные в одной и той же странице (страница — это сегмент памяти, обычно в диапазоне от 2 до 16 Кбайт) таблицы одновременно

Блокировка строк:
- Не позволяет нескольким пользователям одновременно изменять одну и ту же строку в таблице

## Преимущества и недостатки

Блокировка всей таблицы:
- Требует небольшого времени
- При увеличении числа пользователей может привести к долгим ожиданиям

Блокировка строк:
- Требует большего объёма дополнительных действий
- Позволяет нескольким пользователям изменять одну и ту же таблицу, если они работают с разными строками

## PostgreSQL и MVCC

PostgreSQL использует многоверсионное управление конкурентностью (MVCC — Multi-Version Concurrency Control) и поддерживает блокировку строк по умолчанию.

MVCC позволяет нескольким транзакциям работать с данными одновременно, создавая для каждой транзакции свою версию данных.

## Назначение блокировок

Блокировка в СУБД нужна для управления одновременным доступом к ресурсам данных.

Это обеспечивает:
- Целостность данных при одновременных изменениях
- Корректную обработку транзакций
- Предотвращение конфликтов при параллельном доступе
