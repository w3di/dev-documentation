## Создание и удаление таблиц

## Создание таблицы

Для создания таблицы используется оператор `CREATE TABLE`.

Базовый синтаксис:

```sql
CREATE TABLE [IF NOT EXISTS] имя_таблицы (
    столбец_1 тип_данных,
    [столбец_2 тип_данных,]
    ...
    [столбец_n тип_данных,]
);
```

Пример создания таблицы пользователей:

```sql
CREATE TABLE Users (
    id INTEGER,
    name VARCHAR(255),
    age INTEGER
);
```

Типы данных:
- `INTEGER` — числовой тип
- `VARCHAR(255)` — строковый тип с максимальной длиной 255 символов

## Дополнительные параметры определения столбцов

Помимо названия столбца и его типа в определение можно добавлять следующие параметры:

`PRIMARY KEY`:
- Указывает колонку как первичный ключ

`SERIAL` или `GENERATED ALWAYS AS IDENTITY`:
- Указывает, что значение колонки будет автоматически увеличиваться при добавлении новых записей
- `SERIAL` — это сокращение для создания автоинкрементного поля

`UNIQUE`:
- Указывает, что значения в колонке для всех записей должны быть отличными друг от друга

`NOT NULL`:
- Указывает, что значения в колонке должны быть отличными от `NULL`

`DEFAULT`:
- Указывает значение по умолчанию

Пример с параметрами:

```sql
CREATE TABLE Users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    age INTEGER NOT NULL DEFAULT 18
);
```

В данном примере:
- `id` — поле типа `SERIAL` (автоинкрементное целое число), являющееся первичным ключом
- `name` — поле строкового типа с максимальной длиной 255 символов, обязательное к заполнению
- `age` — поле числового типа со значением по умолчанию 18

## Описание таблицы

Для просмотра описания созданной таблицы используется запрос к информационной схеме:

```sql
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'users';
```

Результат:

```
column_name    data_type           is_nullable    column_default
id             integer             NO             nextval('users_id_seq'::regclass)
name           character varying   NO             <NULL>
age            integer             NO             18
```

## Дополнительные параметры определения таблицы

### Первичный ключ

Если первичный ключ не определён через параметры столбца, это можно сделать после перечисления столбцов:

```sql
CREATE TABLE Users (
    id INTEGER,
    name VARCHAR(255) NOT NULL,
    age INTEGER NOT NULL DEFAULT 18,
    PRIMARY KEY (id)
);
```

### Внешние ключи

Создание таблицы компаний:

```sql
CREATE TABLE Companies (
    id INTEGER,
    name VARCHAR(255) NOT NULL,
    PRIMARY KEY (id)
);
```

Добавление внешнего ключа в таблицу пользователей:

```sql
CREATE TABLE Users (
    id INTEGER,
    name VARCHAR(255) NOT NULL,
    age INTEGER NOT NULL DEFAULT 18,
    company INTEGER,
    PRIMARY KEY (id),
    FOREIGN KEY (company) REFERENCES Companies (id)
);
```

Синтаксис внешнего ключа:

```sql
FOREIGN KEY (<столбец_1>, <столбец_n>)
REFERENCES <внешняя_таблица> (<столбец_во_внешней_таблице_1>, <столбец_во_внешней_таблице_n>)
[ON DELETE действие]
[ON UPDATE действие]
```

### Поведение при изменении или удалении связанных записей

```sql
CREATE TABLE Users (
    id INTEGER,
    name VARCHAR(255) NOT NULL,
    age INTEGER NOT NULL DEFAULT 18,
    company INTEGER,
    PRIMARY KEY (id),
    FOREIGN KEY (company) REFERENCES Companies (id)
    ON DELETE RESTRICT ON UPDATE CASCADE
);
```

Действия при удалении (`ON DELETE`):
- `RESTRICT` — запрещает удаление родительской записи, если есть ссылки на неё
- `CASCADE` — автоматически удаляет все связанные записи
- `SET NULL` — устанавливает значение `NULL` в столбце внешнего ключа

Действия при обновлении (`ON UPDATE`):
- `CASCADE` — автоматически обновляет значение внешнего ключа при изменении первичного ключа

Пример ошибки при `ON DELETE RESTRICT`:

```
Cannot delete or update a parent row: a foreign key constraint fails
```

## Удаление таблицы

Удаление таблицы производится при помощи оператора `DROP TABLE`:

```sql
DROP TABLE [IF EXISTS] имя_таблицы;
```

## Важные моменты

- Используйте `IF NOT EXISTS` при создании таблицы для предотвращения ошибок
- Используйте `IF EXISTS` при удалении таблицы для предотвращения ошибок
- Внешние ключи обеспечивают целостность данных между таблицами
- При удалении таблицы удаляются все её данные и связанные объекты
- Нельзя удалить таблицу, если на неё ссылаются другие таблицы через внешние ключи (при использовании `RESTRICT`)
