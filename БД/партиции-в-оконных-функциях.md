## Партиции в оконных функциях

Партиции — подмножества строк, выделенные для оконной функции на основе одного или нескольких столбцов в таблице.

Они служат для сегментации данных, позволяя выполнить более детальный анализ и расчёты вроде агрегации или ранжирования внутри каждой такой группы.

Применяя партиционирование, например, по типу жилья в таблице с данными о цене жилья, можно рассчитать в отдельной колонке среднюю цену для каждого типа жилья.

## Применение партиций в SQL

Для использования партиции вместе с оконной функцией используется следующий синтаксис:

```sql
SELECT <оконная_функция>(<поле_таблицы>)
OVER (
    PARTITION BY <столбцы_для_разделения>
)
```
Синтаксис использования партиций с оконными функциями

## Пример использования

Таблица Rooms с полями home_type и price содержит данные о жилье, разделённом на 3 категории: «Private room», «Entire home/apt» и «Shared room».

```sql
SELECT
    home_type, price,
    AVG(price) OVER (PARTITION BY home_type) AS avg_price
FROM Rooms
```
Вычисляет среднюю цену для каждой категории жилья

Что происходит в запросе:
- PARTITION BY home_type делит все записи на разные партиции на основе уникальных значений столбца home_type
- Для каждой записи AVG(price) вычисляет среднюю цену в рамках её партиции

Результат — столбец avg_price, в котором для каждой записи указано среднее значение цены для её категории жилья.

## Партиции по нескольким колонкам

Партиционирование может быть выполнено по нескольким колонкам. Это позволяет создавать более сложные и точные сегменты для анализа.

```sql
SELECT
    home_type, has_tv, price,
    AVG(price) OVER (PARTITION BY home_type, has_tv) AS avg_price
FROM Rooms
```
Создаёт партиции на основе категории жилья и наличия телевизора

PARTITION BY home_type, has_tv создаёт уникальные партиции для каждой комбинации home_type и has_tv, позволяя вычислить среднюю цену жилья для текущей категории с наличием или без наличия телевизора.

Порядок перечисления столбцов в PARTITION BY определяет приоритет группировки.
