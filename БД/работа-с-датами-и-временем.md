## Работа с датами и временем

Для работы с датой и временем в PostgreSQL есть несколько типов данных: `DATE`, `TIME`, `TIMESTAMP`, `TIMESTAMPTZ` и `INTERVAL`.

## Типы данных

| Тип | Описание | Диапазон значений | Размер |
|-----|----------|-------------------|--------|
| `DATE` | Хранит значения даты в виде ГГГГ-ММ-ДД. Например, `2022-12-05` | от 4713 BC до 5874897 AD | 4 байта |
| `TIME` | Хранит значения времени в формате ЧЧ:ММ:СС. Например, `14:30:45` | от 00:00:00 до 24:00:00 | 8 байт |
| `TIMESTAMP` | Хранит значение даты и времени без часового пояса. Например, `2022-12-05 10:37:22` | от 4713 BC до 294276 AD | 8 байт |
| `TIMESTAMPTZ` | Хранит значение даты и времени с часовым поясом. Например, `2022-12-05 10:37:22+03` | от 4713 BC до 294276 AD | 8 байт |
| `INTERVAL` | Хранит интервал времени. Например, `1 year 2 months 3 days 4 hours` | от -178000000 лет до 178000000 лет | 16 байт |

## Отличие TIMESTAMP и TIMESTAMPTZ

В PostgreSQL есть два основных типа для хранения даты и времени: `TIMESTAMP` (без часового пояса) и `TIMESTAMPTZ` (с часовым поясом).

### TIMESTAMP

Тип `TIMESTAMP` (или `TIMESTAMP WITHOUT TIME ZONE`) хранит дату и время без информации о часовом поясе. PostgreSQL не знает, в каком часовом поясе была записана дата, и не производит никаких преобразований.

```sql
CREATE TABLE timestamp_table (timestamp_field TIMESTAMP);
SET timezone = 'UTC';
INSERT INTO timestamp_table VALUES('2022-06-16 16:37:23');
SET timezone = 'Europe/Moscow';
SELECT * FROM timestamp_table;
```

Результат: `2022-06-16 16:37:23` (значение не изменилось)

### TIMESTAMPTZ

Тип `TIMESTAMPTZ` (или `TIMESTAMP WITH TIME ZONE`) хранит дату и время с информацией о часовом поясе. PostgreSQL автоматически преобразует время в UTC для хранения и обратно в локальный часовой пояс при выводе.

```sql
CREATE TABLE timestamptz_table (timestamptz_field TIMESTAMPTZ);
SET timezone = 'UTC';
INSERT INTO timestamptz_table VALUES('2022-06-16 16:37:23');
SET timezone = 'Europe/Moscow';
SELECT * FROM timestamptz_table;
```

Результат: `2022-06-16 19:37:23+03` (время автоматически скорректировано)

### Рекомендации

Используйте `TIMESTAMP`:
- Когда часовой пояс не имеет значения
- Для локальных событий (например, расписание работы магазина)
- Когда все данные в одном часовом поясе

Используйте `TIMESTAMPTZ`:
- Для глобальных приложений с пользователями из разных часовых поясов
- Когда важно отслеживать точное время события
- Для логов и аудита
- В большинстве случаев (это предпочтительный тип)

## INTERVAL

Тип `INTERVAL` используется для хранения периодов времени. Он может представлять промежутки в годах, месяцах, днях, часах, минутах и секундах.

```sql
SELECT '1 year 2 months 3 days 4 hours 5 minutes 6 seconds'::INTERVAL;
SELECT '2 weeks'::INTERVAL;
SELECT '90 minutes'::INTERVAL;
```

Использование с арифметическими операциями:

```sql
SELECT NOW() + INTERVAL '1 day';
SELECT NOW() - INTERVAL '3 hours';
SELECT NOW() + INTERVAL '2 weeks 3 days';
```

Примеры:

```sql
CREATE TABLE Tasks (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    duration INTERVAL
);

INSERT INTO Tasks (name, duration) VALUES 
    ('Task 1', '2 hours'),
    ('Task 2', '1 day 3 hours'),
    ('Task 3', '30 minutes');

SELECT name, created_at + duration AS deadline 
FROM Tasks;
```

## Способы задания значений

Значения типов даты и времени могут быть заданы в различных форматах:

Как строка в формате ISO 8601:
- `'YYYY-MM-DD HH:MM:SS'`

Как строка с указанием часового пояса:
- `'YYYY-MM-DD HH:MM:SS+TZ'`

Только дата:
- `'YYYY-MM-DD'`

Только время:
- `'HH:MM:SS'`

Пример:

```sql
CREATE TABLE date_table (
    date_field DATE,
    time_field TIME,
    timestamp_field TIMESTAMP,
    timestamptz_field TIMESTAMPTZ
);

INSERT INTO date_table VALUES(
    '2022-06-16',
    '16:37:23',
    '2022-06-16 16:37:23',
    '2022-06-16 16:37:23+03'
);

SELECT * FROM date_table;
```

PostgreSQL строго следует стандарту ISO 8601 и предпочитает использовать стандартные форматы дат.

## Установка часового пояса

Для установки часового пояса используется команда `SET timezone`:

```sql
SET timezone = 'UTC';
SET timezone = 'Europe/Moscow';
SET timezone = 'America/New_York';
```

Проверка текущего часового пояса:

```sql
SHOW timezone;
```

## Полезные функции для работы с датами

```sql
NOW()
SELECT NOW();

CURRENT_DATE
SELECT CURRENT_DATE;

CURRENT_TIME
SELECT CURRENT_TIME;

CURRENT_TIMESTAMP
SELECT CURRENT_TIMESTAMP;
```

## Примеры использования

```sql
CREATE TABLE Events (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    event_date DATE,
    event_time TIME,
    created_at TIMESTAMP DEFAULT NOW(),
    scheduled_at TIMESTAMPTZ,
    duration INTERVAL
);

INSERT INTO Events (name, event_date, event_time, scheduled_at, duration) VALUES 
    ('Meeting', '2024-01-15', '10:00:00', '2024-01-15 10:00:00+00', '2 hours'),
    ('Conference', '2024-02-20', '09:00:00', '2024-02-20 09:00:00+00', '1 day'),
    ('Workshop', '2024-03-10', '14:30:00', '2024-03-10 14:30:00+00', '3 hours 30 minutes');

SELECT 
    name,
    event_date,
    event_time,
    scheduled_at,
    scheduled_at + duration AS end_time
FROM Events;
```

В этом примере:
- `event_date` — дата события (только дата)
- `event_time` — время события (только время)
- `created_at` — время создания записи (с автоматической установкой)
- `scheduled_at` — запланированное время с часовым поясом
- `duration` — продолжительность события
- `end_time` — вычисляемое время окончания (начало + продолжительность)
