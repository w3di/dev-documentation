## Условный оператор WHERE

WHERE фильтрует строки по условию. Если запись удовлетворяет условию, попадает в результат, иначе отбрасывается.

```sql
SELECT [DISTINCT] поля_таблиц FROM наименование_таблицы
WHERE условие_на_ограничение_строк
[логический_оператор другое_условие_на_ограничение_строк];
```
Общая структура запроса с WHERE

```sql
SELECT * FROM Student
WHERE first_name = 'Grigorij' AND EXTRACT(YEAR FROM birthday) > 2000;
```
Выбирает студентов с именем Grigorij, родившихся после 2000 года

Операторы сравнения:

Результат сравнения: true (1), false (0) или NULL

Операторы:
- = равенство
- <> или != неравенство
- < меньше
- <= меньше или равно
- > больше
- >= больше или равно

Сравнение любого значения с NULL даёт NULL

```sql
SELECT
    2 = 1 AS "2 = 1",
    'a' = 'a' AS "'a' = 'a'",
    2 <> 2 AS "2 <> 2",
    3 < 4 AS "3 < 4",
    10 <= 10 AS "10 <= 10",
    7 > 1 AS "7 > 1",
    8 >= 10 AS "8 >= 10";
```
Примеры операторов сравнения

Логические операторы:

AND — оба условия должны быть верны

```sql
SELECT * FROM Trip
WHERE plane = 'Boeing' AND town_from = 'London';
```
Выбирает рейсы на Boeing из London

OR — достаточно выполнения хотя бы одного условия

```sql
SELECT * FROM Trip
WHERE town_to = 'Paris' OR plane = 'Airbus';
```
Выбирает рейсы в Paris или на Airbus

NOT — инвертирует условие

```sql
SELECT * FROM Trip WHERE NOT town_to = 'Moscow';
```
Выбирает все рейсы, кроме тех, что прилетают в Moscow

XOR — выполняется только одно из двух условий, но не оба

В PostgreSQL нет оператора XOR, используется комбинация AND и OR:

```sql
SELECT * FROM trip
WHERE (town_from = 'Moscow' AND town_to != 'Paris')
   OR (town_from != 'Moscow' AND town_to = 'Paris');
```
Выбирает рейсы, которые вылетают из Moscow или прилетают в Paris, но не оба условия одновременно

Приоритет логических операторов:

Порядок выполнения:
1. NOT
2. AND
3. XOR
4. OR

```sql
SELECT *
FROM Trip
WHERE town_to = 'Paris'
    OR plane = 'Boeing'
    AND NOT town_from = 'Moscow';
```
Сначала проверяется NOT, затем AND, потом OR. Результат: рейсы в Paris или рейсы на Boeing не из Moscow

Скобки изменяют порядок выполнения:

```sql
SELECT *
FROM Trip
WHERE (
    town_to = 'Paris'
    OR (
        plane = 'Boeing'
        AND (NOT town_from = 'Moscow')
    )
);
```
Явное указание порядка выполнения через скобки

## Операторы IS NULL, BETWEEN, IN

IS NULL:

Проверяет, равно ли значение NULL

```sql
SELECT * FROM Teacher
WHERE middle_name IS NULL;
```
Выбирает записи, где поле равно NULL

```sql
SELECT * FROM Teacher
WHERE middle_name IS NOT NULL;
```
Выбирает записи, где поле не равно NULL

BETWEEN:

Проверяет, находится ли значение в интервале между min и max включительно

Эквивалентно: field >= min AND field <= max

```sql
SELECT * FROM Payments
WHERE unit_price BETWEEN 100 AND 500;
```
Выбирает записи, где unit_price от 100 до 500 включительно

IN:

Проверяет, входит ли значение в список

```sql
SELECT * FROM FamilyMembers
WHERE status IN ('father', 'mother');
```
Выбирает записи, где status равен 'father' или 'mother'

## Оператор LIKE

LIKE проверяет, соответствует ли строка шаблону

```sql
... WHERE поле_таблицы [NOT] LIKE шаблон_строки
```
Синтаксис оператора LIKE

Специальные символы:
- % — последовательность любых символов (0 и более)
- _ — любой единичный символ

```sql
SELECT name, email FROM Users
WHERE email LIKE '%@hotmail.%'
```
Выбирает пользователей с email в домене hotmail

Примеры шаблонов:

```sql
... WHERE поле_таблицы LIKE 'text%'
```
Строки, начинающиеся на 'text'

```sql
... WHERE поле_таблицы LIKE '%text'
```
Строки, заканчивающиеся на 'text'

```sql
... WHERE поле_таблицы LIKE '_ext'
```
Строки длиной 4 символа, где последние 3 — 'ext' (например, 'text', 'next')

```sql
... WHERE поле_таблицы LIKE 'begin%end'
```
Строки, начинающиеся на 'begin' и заканчивающиеся на 'end'

ILIKE:

В PostgreSQL LIKE чувствителен к регистру. ILIKE выполняет поиск без учета регистра

ESCAPE-символ:

Используется для экранирования специальных символов (% и _)

```sql
... WHERE поле_таблицы LIKE 'шаблон_строки' ESCAPE 'символ_экранирования'
```
Синтаксис с ESCAPE

```sql
SELECT job_id FROM Jobs
WHERE progress LIKE '3!%' ESCAPE '!';
```
Выбирает записи, где progress равен '3%' (символ % экранирован)

## Оператор регулярных выражений ~

~ и ~* используются для поиска по регулярным выражениям. Подходят для сложных шаблонов, которые трудно реализовать через LIKE.

```sql
... WHERE table_field ~ 'pattern';
```
Поиск с учетом регистра

```sql
... WHERE table_field ~* 'pattern';
```
Поиск без учета регистра

Специальные символы:

Символы требуют экранирования обратным слешем \: ., *, +, ?, [, ], (, ), {, }, |, \

Специальные символы и структуры:
- * — 0 или более экземпляров предшествующей строки
- + — 1 или более экземпляров предшествующих строк
- . — любой одиночный символ
- ? — 0 или 1 экземпляр предшествующей строки
- ^ — начало строки
- $ — окончание строки
- [abc] — любой символ из списка
- [^abc] — любой символ, не из списка
- [A-Z], [А-Я] — заглавные буквы
- [a-z], [а-я] — строчные буквы
- [0-9] — цифры
- p1|p2|p3 — любой из паттернов
- {n} — n экземпляров предыдущей строки
- {m,n} — от m до n экземпляров предыдущей строки

Примеры:

```sql
SELECT * FROM Users WHERE name ~ '^John'
```
Имена, начинающиеся на 'John'. Символ ^ указывает начало строки

```sql
SELECT * FROM Subject WHERE name ~ '[ey]$'
```
Названия, оканчивающиеся на 'e' или 'y'. [ey] — список возможных значений, $ — конец строки

```sql
SELECT * FROM Users WHERE email ~ '@(outlook\.com|icloud\.com)$'
```
Email, оканчивающиеся на '@outlook.com' или '@icloud.com'. | — выбор вариантов, \. — экранированная точка

```sql
SELECT * FROM Users WHERE phone_number ~ '^[^28]*$'
```
Номера телефонов без цифр '2' и '8'. [^28] — любой символ кроме '2' и '8', * — любое количество

```sql
SELECT name, phone_number FROM Users WHERE phone_number ~ '^\+7'
```
Номера, начинающиеся на '+7'. \+ — экранированный знак плюс, ^ — начало строки
