# Формирование архитектуры

Четыре правила простой архитектуры (Кент Бек), в порядке убывания важности:

### Правило 1: выполнение всех тестов

- Система должна быть контролируемой: непроверенная система не должна запускаться в эксплуатацию
- Классы, соответствующие принципу единой ответственности, проще тестировать; чем больше тестов — тем сильнее стремление к простоте
- Жёсткая привязка усложняет написание тестов; тесты подталкивают к использованию DIP, внедрения зависимостей, интерфейсов и абстракций
- Написание тестов улучшает архитектуру системы

### Правила 2–4: переработка кода

- Когда есть полный набор тестов — можно безопасно заниматься чисткой кода и классов
- Добавляем код, делаем паузу, анализируем: не ухудшилась ли архитектура? Если ухудшилась — чистим и прогоняем тесты
- В фазе переработки применяется всё: повышение связности, устранение жёстких привязок, разделение ответственности, сокращение объёма функций и классов, выбор содержательных имён

### Отсутствие дублирования

- Дублирование — главный враг хорошо спроектированной системы: лишняя работа, лишний риск, лишняя сложность
- Дублирование бывает не только в одинаковых строках кода, но и в дублировании реализации (два метода делают похожее разными способами)
- Принцип повторного использования даже в мелочах может привести к значительному сокращению сложности; понимание повторного использования в мелочах необходимо для его обеспечения в больших масштабах
- Паттерн «Шаблонный метод» — стандартный приём устранения высокоуровневого дублирования: общий алгоритм в базовом классе, различающиеся шаги — в подклассах

### Выразительность

- Код должен чётко выражать намерения автора; чем понятнее код, тем меньше времени на его понимание и меньше дефектов при сопровождении
- Хороший выбор имён: имя класса или функции должно восприниматься «на слух» и не вызывать удивления при чтении реализации
- Компактные классы и функции проще именовать, писать и понимать
- Стандартная номенклатура: включение названий паттернов (Команда, Посетитель) в имена классов помогает кратко описать архитектуру
- Хорошо написанные модульные тесты — разновидность документации на примерах
- Самое важное для выразительности — сознательно стараться сделать код выразительным; не переходить к следующей задаче, как только код «заработал»

### Минимум классов и методов

- Стремление к устранению дубликатов и SRP может зайти слишком далеко — не плодить крошечные классы и методы без необходимости
- Избегать бессмысленного догматизма (например, «интерфейс для каждого класса» или «данные и поведение всегда в разных классах»)
- Это правило обладает наименьшим приоритетом из четырёх: прохождение тестов, устранение дубликатов и выразительность кода важнее
