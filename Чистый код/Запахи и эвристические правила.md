# Запахи и эвристические правила

### Комментарии

### C1: Неуместная информация
- Комментарий не должен содержать информацию, которую лучше хранить в другой системе (система контроля версий, баг-трекер и т.д.)

### C2: Устаревший комментарий
- Комментарий, который устарел, потерял актуальность или стал неверным — хуже, чем отсутствие комментария; удаляй или обновляй сразу

### C3: Избыточный комментарий
- Комментарий избыточен, если код достаточно выразителен сам по себе; комментарий не должен повторять то, что и так очевидно из кода

### C4: Плохо написанный комментарий
- Если решил написать комментарий — напиши его хорошо; выбирай слова тщательно, следи за грамматикой, не бормочи

### C5: Закомментированный код
- Закомментированный код загнивает и сбивает с толку; удаляй его — система контроля версий помнит всё

### Рабочая среда

### E1: Построение состоит из нескольких этапов
- Построение проекта должно выполняться одной простой командой; не заставляй разработчика искать и собирать компоненты вручную

### E2: Тестирование состоит из нескольких этапов
- Все модульные тесты должны запускаться одной быстрой командой; чем сложнее запустить тесты, тем реже их запускают

### Функции

### F1: Слишком много аргументов
- Функции не должны иметь много аргументов; идеально — ноль, допустимо — один-два, три — только при крайней необходимости

### F2: Выходные аргументы
- Выходные аргументы неинтуитивны; если функция должна изменять состояние, пусть она меняет состояние своего объекта-владельца

### F3: Флаги в аргументах
- Логический аргумент-флаг явно указывает на то, что функция делает более одной вещи; раздели на две функции

### F4: Мёртвые функции
- Функции, которые никогда не вызываются, должны удаляться; система контроля версий их сохранит

### Разное

### G1: Несколько языков в одном исходном файле
- В идеале файл содержит один язык; на практике — минимизируй количество и объём дополнительных языков в файле

### G2: Очевидное поведение не реализовано
- Функция или класс должны реализовывать поведение, которое другой программист разумно ожидает от них; нарушение подрывает доверие к коду

### G3: Некорректное граничное поведение
- Не полагайся на интуицию — проверяй каждое граничное условие; пиши тесты для каждого граничного случая

### G4: Отключённые средства безопасности
- Не отключай предупреждения компилятора, проваливающиеся тесты и т.п. — это опасно; ошибки напомнят о себе позже

### G5: Дублирование
- Одна из важнейших эвристик; каждый раз, когда видишь дублирование — выноси в абстракцию (функцию, базовый класс, паттерн)

### G6: Код на неверном уровне абстракции
- Разделяй высокоуровневые концепции (в базовом классе) от низкоуровневых деталей (в производных); константы, переменные и служебные функции должны быть на правильном уровне

### G7: Базовые классы, зависящие от производных
- Базовый класс не должен ничего знать о своих производных; исключения крайне редки

### G8: Слишком много информации
- Хорошо определённые модули имеют маленькие интерфейсы; чем меньше методов, переменных и констант выставлено наружу, тем лучше

### G9: Мёртвый код
- Код, который не выполняется (недостижимые ветки, неиспользуемые функции, условия, которые никогда не выполняются) — удаляй

### G10: Вертикальное разделение
- Переменные и функции должны объявляться рядом с местом использования; локальные переменные — прямо перед первым использованием; приватные функции — сразу под первым вызовом

### G11: Непоследовательность
- Если делаешь что-то определённым способом — делай так везде; последовательность снижает когнитивную нагрузку и облегчает чтение

### G12: Балласт
- Неиспользуемые переменные, невызываемые функции, бессодержательные комментарии, пустые конструкторы по умолчанию — всё это балласт; удаляй

### G13: Искусственные привязки
- Не размещай вещи вместе просто так; элементы, не зависящие друг от друга, не должны быть связаны (например, перечисления в не том классе)

### G14: Функциональная зависть
- Методы класса должны быть заинтересованы в переменных и функциях своего класса, а не чужого; если метод обращается к чужим данным — возможно, он должен быть в том классе

### G15: Аргументы-селекторы
- Логические, перечислимые или целочисленные аргументы, выбирающие поведение функции — запах; лучше несколько функций с ясными именами

### G16: Непонятные намерения
- Код должен быть максимально выразительным; не используй «волшебные» числа, венгерскую запись, непонятные сокращения

### G17: Неверное размещение
- Код должен находиться там, где читатель ожидает его найти; решение о размещении основывается на принципе наименьшего удивления

### G18: Неуместные статические методы
- Статический метод уместен, если нет разумной потребности в полиморфном поведении; при сомнениях — делай нестатическим

### G19: Используйте пояснительные переменные
- Промежуточные переменные с содержательными именами делают алгоритм понятнее; не жалей их

### G20: Имена функций должны описывать выполняемую операцию
- Если для понимания действия функции приходится смотреть реализацию — имя выбрано неудачно

### G21: Понимание алгоритма
- Прежде чем считать функцию завершённой, убедись, что ты понимаешь, как она работает; «кажется, работает» — недостаточно

### G22: Преобразование логических зависимостей в физические
- Если модуль зависит от другого на логическом уровне, эта зависимость должна быть выражена в коде явно (через аргументы, интерфейсы), а не подразумеваться

### G23: Используйте полиморфизм вместо if/else или switch/case
- Для одного и того же выбора в коде должна быть только одна конструкция switch; в остальных случаях — полиморфизм

### G24: Соблюдайте стандартные конвенции
- Группа должна выработать стандарт кодирования и последовательно ему следовать; стандарт не должен быть описан в документе — код сам должен быть примером

### G25: Заменяйте «волшебные числа» именованными константами
- Числа в коде без имени скрывают намерение; заменяй их именованными константами с говорящими именами

### G26: Будьте точны
- Не используй float для денежных сумм, не игнорируй параллельный доступ, не принимай первый элемент списка, когда может быть несколько; принимай решения осознанно и точно

### G27: Структура важнее конвенций
- Проектные решения, закреплённые в структуре кода, надёжнее решений, основанных на конвенциях; конвенции легко нарушить, структуру — нет

### G28: Инкапсулируйте условные конструкции
- Сложные условия выноси в функции с говорящими именами; `if (shouldBeDeleted(timer))` лучше, чем `if (timer.hasExpired() && !timer.isRecurrent())`

### G29: Избегайте отрицательных условий
- Положительные условия читаются проще, чем отрицательные; `if (buffer.shouldCompact())` лучше, чем `if (!buffer.shouldNotCompact())`

### G30: Функции должны выполнять одну операцию
- Функция, делающая несколько вещей, должна быть разделена на функции, каждая из которых делает одну

### G31: Скрытые временные привязки
- Если порядок вызовов важен, сделай его очевидным в структуре кода (например, через аргументы или объединение в один метод)

### G32: Структура кода должна быть обоснована
- Каждый элемент структуры должен иметь причину; не добавляй параметр или зависимость «на всякий случай»

### G33: Инкапсулируйте граничные условия
- Граничные условия трудно отслеживать; сосредоточь их обработку в одном месте, не разбрасывай +1 и −1 по коду

### G34: Функции должны быть написаны на одном уровне абстракции
- Не смешивай высокоуровневые концепции с низкоуровневыми деталями в одной функции

### G35: Храните конфигурационные данные на высоких уровнях
- Константы конфигурации (значения по умолчанию, настройки) принадлежат высокоуровневым модулям; из них данные передаются вниз через аргументы

### G36: Избегайте транзитивных обращений
- Модуль не должен знать о структуре того, с чем он взаимодействует; `a.getB().getC().doSomething()` — нарушение (закон Деметры)

### Имена

### N1: Используйте содержательные имена
- Имя должно описывать назначение; не жалей времени на выбор; переименовывай, если нашёл лучшее имя

### N2: Выбирайте имена на подходящем уровне абстракции
- Имя не должно описывать реализацию; оно должно отражать уровень абстракции класса или функции

### N3: По возможности используйте стандартную номенклатуру
- Используй названия паттернов и устоявшиеся термины; если проект использует DECORATOR — назови `AutoHangupModemDecorator`

### N4: Недвусмысленные имена
- Имя должно однозначно описывать функцию или переменную; чем длиннее область видимости — тем точнее и длиннее должно быть имя

### N5: Используйте длинные имена для длинных областей видимости
- Имя `i` допустимо в цикле из 5 строк; для переменной с широкой областью видимости нужно длинное описательное имя

### N6: Избегайте кодирования
- Не кодируй тип или область видимости в именах (венгерская запись, префикс `m_` и т.п.); современные среды и компиляторы делают это ненужным

### N7: Имена должны описывать побочные эффекты
- Если функция не просто получает значение, а создаёт его при отсутствии — имя должно это отражать (например, `createOrReturnOos` вместо `getOos`)

### Тесты

### T1: Нехватка тестов
- Тестов должно быть столько, сколько нужно для уверенности; если условие не проверено — тест не полон

### T2: Используйте средства анализа покрытия кода
- Анализ покрытия помогает найти непротестированные участки; непокрытые строки часто указывают на пропущенные сценарии

### T3: Не пропускайте тривиальные тесты
- Тривиальные тесты легко писать, и они документируют ожидаемое поведение

### T4: Отключённый тест как вопрос
- Отключённый тест — это вопрос о неясном поведении; его стоит включить и разобраться, а не оставлять закомментированным

### T5: Тестируйте граничные условия
- Граничные условия — самое частое место ошибок; уделяй им особое внимание

### T6: Тщательно тестируйте код рядом с ошибками
- Ошибки группируются; если нашёл одну ошибку в функции — тщательно проверь остальную часть

### T7: Закономерности сбоев часто несут полезную информацию
- Если тесты сбоят по определённому шаблону — это подсказка о причине; анализируй закономерности

### T8: Закономерности покрытия кода часто несут полезную информацию
- Посмотри, какие участки не покрыты тестами — это подсказка, где прячутся ошибки

### T9: Тесты должны работать быстро
- Медленные тесты запускаются реже; делай всё для того, чтобы тесты были быстрыми
