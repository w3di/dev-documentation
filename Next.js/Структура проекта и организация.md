## Структура проекта Next.js и организация кода

Эта тема описывает соглашения по папкам и файлам в Next.js, а также рекомендуемые подходы к организации проекта.

### Верхнеуровневые папки

- **app**: Маршрутизатор App Router (рекомендуется для Next.js 13+).
- **pages**: Маршрутизатор Pages Router (устоявшийся, но постепенно вытесняется `app`).
- **public**: Статические ресурсы, доступные напрямую по URL.
- **src**: Необязательная папка-обёртка для исходников (может содержать `app`, `pages` и прочее).

### Верхнеуровневые файлы

- **next.config.js**: Конфигурация Next.js.
- **package.json**: Зависимости проекта и скрипты.
- **instrumentation.ts**: Интеграция OpenTelemetry/Instrumentation.
- **middleware.ts**: Middleware-запросов Next.js (выполняется на Edge/Server).
- **.env / .env.local / .env.production / .env.development**: Переменные окружения.
- **.eslintrc.json**: Конфигурация ESLint.
- **.gitignore**: Игнорируемые Git файлы/папки.
- **next-env.d.ts**: Типы Next.js для TypeScript.
- **tsconfig.json / jsconfig.json**: Конфигурация TypeScript/JavaScript путей и компилятора.

---

## Файлы маршрутизации (App Router)

Добавляйте специальные файлы в сегментах маршрутов:

- **layout.(js|jsx|tsx)**: Общий каркас (header/nav/footer), оборачивает дочерние сегменты.
- **page.(js|jsx|tsx)**: Страница (публичный маршрут).
- **loading.(js|jsx|tsx)**: Скелет загрузки (React Suspense boundary).
- **not-found.(js|jsx|tsx)**: UI для 404 (React error boundary).
- **error.(js|jsx|tsx)**: Локальная error boundary.
- **global-error.(js|jsx|tsx)**: Глобальная error boundary на корне.
- **route.(js|ts)**: Обработчик API-эндпоинта (в App Router).
- **template.(js|jsx|tsx)**: Пере-рендерящийся layout (пересоздаётся чаще, чем `layout`).
- **default.(js|jsx|tsx)**: Фолбэк-страница для параллельных маршрутов.


### Динамические маршруты

- `[segment]` — один параметр.
- `[...segment]` — «catch‑all» (захват всех оставшихся сегментов).
- `[[...segment]]` — опциональный catch‑all.


### Группы маршрутов и приватные папки

- **Группы маршрутов**: `(folderName)` — используются для организации, не влияют на URL.
- **Приватные папки**: `_folderName` — исключаются из системы маршрутизации, можно безопасно хранить внутренние файлы.

Подсказки:

- Можно создать URL-сегмент, начинающийся с подчёркивания, через URL-кодирование: `%5FfolderName`.
- Даже без `_` файлы в `app` безопасно колоцировать — они не становятся маршрутами, пока не существует `page.tsx` или `route.ts` в сегменте.

### Параллельные и перехватываемые маршруты

- **`@slot`**: Именованные слоты, которые рендерятся в layout для сложных схем (например, sidebar + контент).
- **Перехват (Intercepted routes)**: Используйте префиксы для папок:
  - `(.)folder` — перехват на том же уровне (показ соседнего маршрута, напр., модальное окно).
  - `(..)folder` — перехват родителя.
  - `(..)(..)folder` — перехват на два уровня выше.
  - `(...)folder` — перехват от корня — отрендерить любой маршрут в текущем layout.

Типичный кейс: показать детальную карточку как модальное окно поверх списка, не меняя URL.

---

## Метаданные и медиа-файлы

Иконки приложения:

- **favicon.(ico)** — фавикон.
- **icon.(ico|jpg|jpeg|png|svg)** — иконка приложения (статичная).
- **icon.(js|ts|tsx)** — сгенерированная иконка.
- **apple-icon.(jpg|jpeg|png)** — иконка для Apple.
- **apple-icon.(js|ts|tsx)** — сгенерированная Apple-иконка.

Open Graph и Twitter:

- **opengraph-image.(jpg|jpeg|png|gif)** или **.js|.ts|.tsx** — статичное изображение или генератор.
- **twitter-image.(jpg|jpeg|png|gif)** или **.js|.ts|.tsx** — статичное изображение или генератор.

SEO файлы:

- **sitemap.xml** или **sitemap.(js|ts)** — карта сайта (статичная или генерируемая).
- **robots.txt** или **robots.(js|ts)** — правила индексации (статичные или генерируемые).

---

## Иерархия специальных компонентов

Порядок рендера в пределах сегмента:

1. `layout.js`
2. `template.js`
3. `error.js` (локальная boundary)
4. `loading.js` (Suspense boundary)
5. `not-found.js` (boundary для 404)
6. `page.js` или вложенный `layout.js`

Компоненты каждого вложенного сегмента рекурсивно встраиваются внутрь компонентов родительского сегмента.

---

## Колокация

В `app` структура маршрутов задаётся папками, но маршрут становится публичным только при наличии `page.js` или `route.js` в сегменте. Это означает, что служебные файлы (компоненты, утилиты, тесты и т. д.) можно безопасно хранить рядом — они не станут маршрутами автоматически.

Если хотите, можете держать служебные файлы вне `app` — это вопрос предпочтений команды.

### Приватные папки (`_folder`)

Полезны для:

- Отделения UI-логики от роутинга.
- Единообразной внутренней структуры по проекту.
- Упорядочивания файлов в IDE.
- Избежания конфликтов с будущими спец. файлами Next.js.

---

## Группы маршрутов `(group)`

Нужны чтобы:

- Организовать маршруты по разделам/командам (например, `(marketing)`, `(admin)`).
- Иметь несколько layout на одном уровне сегмента (вплоть до нескольких корневых layout).
- Применять layout только к подмножеству маршрутов.



## Резюме рекомендаций

- Чётко разделяйте ответственность: роутинг (`app`) и общий код (колокация рядом или в отдельных папках) — на ваше усмотрение.
- Используйте группы `(folder)` для организации и многообразных layout без изменения URL.
- Применяйте `_folder` для приватных внутренних файлов, когда важно явно отделить их от роутинга.
- Для сложных UI-паттернов изучите параллельные и перехватываемые маршруты (`@slot`, `(.)`, `(..)`, `(...)`).
- Храните SEO/иконки в стандартизированных местах и форматах; при необходимости генерируйте их через код.
- Рассмотрите `src/` для изоляции исходников от конфигурации.


